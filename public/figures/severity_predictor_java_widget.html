<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Severity Predictor Widget</title>
<script src="https://cdn.plot.ly/plotly-2.34.0.min.js"></script>
<style>
  body {
    margin: 0;
    background: #2A2A2A;
    color: white;
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
  }
  .container {
    max-width: 1000px;
    margin: 0 auto;
    padding: 10px 12px 20px;
  }
  .row {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 14px;
    margin-top: 8px;
  }
  .label {
    font-size: 16px;
    font-weight: 600;
  }
  .control-bar {
    display: flex;
    align-items: center;
    gap: 14px;
    justify-content: center;
    margin-top: 8px;
  }
  input[type="range"] {
    width: 50%;
  }
  .btn {
    background: #FF6692;
    color: white;
    border: 1px solid white;
    border-radius: 8px;
    padding: 10px 18px;
    font-weight: 700;
    cursor: pointer;
  }
  .btn:active {
    transform: translateY(1px);
  }
  #plot {
    width: 1000px;
    height: 560px;
    margin: 6px auto 0;
  }
</style>
</head>
<body>
<div class="container">
  <div class="row">
    <span class="label">Choose a random seed to select a cell</span>
  </div>
  <div class="control-bar">
    <input id="seedSlider" type="range" min="0" max="100" step="1" value="50" />
    <span id="seedValue">Seed: 50</span>
    <button id="predictBtn" class="btn">Predict!</button>
  </div>

  <div id="plot"></div>
</div>

<script>
  // Embedded data
  const DATA = [{"seed": 0, "sample_idx": 305711, "predicted": "Critical", "actual": "Critical", "confidence": 0.7894523809523808, "match": true}, {"seed": 1, "sample_idx": 128037, "predicted": "Mild", "actual": "Mild", "confidence": 0.7635365363802863, "match": true}, {"seed": 2, "sample_idx": 100879, "predicted": "Mild", "actual": "Mild", "confidence": 0.7946047845337699, "match": true}, {"seed": 3, "sample_idx": 71530, "predicted": "Healthy", "actual": "Healthy", "confidence": 0.9794642857142857, "match": true}, {"seed": 4, "sample_idx": 485815, "predicted": "Severe", "actual": "Severe", "confidence": 0.7539665132798125, "match": true}, {"seed": 5, "sample_idx": 297827, "predicted": "Asymptomatic", "actual": "Asymptomatic", "confidence": 0.965642857142857, "match": true}, {"seed": 6, "sample_idx": 162698, "predicted": "Critical", "actual": "Critical", "confidence": 0.7646507936507938, "match": true}, {"seed": 7, "sample_idx": 585903, "predicted": "Moderate", "actual": "Moderate", "confidence": 0.7255658429617756, "match": true}, {"seed": 8, "sample_idx": 594371, "predicted": "Healthy", "actual": "Healthy", "confidence": 1.0, "match": true}, {"seed": 9, "sample_idx": 516478, "predicted": "Moderate", "actual": "Moderate", "confidence": 0.9388103002070394, "match": true}, {"seed": 10, "sample_idx": 345353, "predicted": "Healthy", "actual": "Healthy", "confidence": 0.9942857142857143, "match": true}, {"seed": 11, "sample_idx": 403353, "predicted": "Moderate", "actual": "Moderate", "confidence": 0.9474206349206349, "match": true}, {"seed": 12, "sample_idx": 472907, "predicted": "Severe", "actual": "Severe", "confidence": 0.7271460028770435, "match": true}, {"seed": 13, "sample_idx": 491858, "predicted": "Severe", "actual": "Severe", "confidence": 0.5750972393092886, "match": true}, {"seed": 14, "sample_idx": 117355, "predicted": "Asymptomatic", "actual": "Asymptomatic", "confidence": 0.9698095238095239, "match": true}, {"seed": 15, "sample_idx": 446197, "predicted": "Moderate", "actual": "Moderate", "confidence": 0.6631341109072088, "match": true}, {"seed": 16, "sample_idx": 629417, "predicted": "Moderate", "actual": "Moderate", "confidence": 0.803290679908327, "match": true}, {"seed": 17, "sample_idx": 589041, "predicted": "Moderate", "actual": "Moderate", "confidence": 0.8218730717167249, "match": true}, {"seed": 18, "sample_idx": 356627, "predicted": "Critical", "actual": "Critical", "confidence": 0.7624420122887864, "match": true}, {"seed": 19, "sample_idx": 521821, "predicted": "Critical", "actual": "Critical", "confidence": 0.6301578732507798, "match": true}, {"seed": 20, "sample_idx": 37135, "predicted": "Asymptomatic", "actual": "Asymptomatic", "confidence": 0.6097318722943723, "match": true}, {"seed": 21, "sample_idx": 605129, "predicted": "Severe", "actual": "Severe", "confidence": 0.5424616845143161, "match": true}, {"seed": 22, "sample_idx": 252036, "predicted": "Mild", "actual": "Mild", "confidence": 0.6745857070849206, "match": true}, {"seed": 23, "sample_idx": 338870, "predicted": "Critical", "actual": "Critical", "confidence": 0.7202253849263789, "match": true}, {"seed": 24, "sample_idx": 242082, "predicted": "Moderate", "actual": "Moderate", "confidence": 0.569819791039927, "match": true}, {"seed": 25, "sample_idx": 29828, "predicted": "Severe", "actual": "Severe", "confidence": 0.835937950937951, "match": true}, {"seed": 26, "sample_idx": 316213, "predicted": "Healthy", "actual": "Healthy", "confidence": 0.99, "match": true}, {"seed": 27, "sample_idx": 380600, "predicted": "Healthy", "actual": "Healthy", "confidence": 0.9957142857142857, "match": true}, {"seed": 28, "sample_idx": 42241, "predicted": "Moderate", "actual": "Moderate", "confidence": 0.8761101132188088, "match": true}, {"seed": 29, "sample_idx": 272893, "predicted": "Mild", "actual": "Mild", "confidence": 0.6185512069956025, "match": true}, {"seed": 30, "sample_idx": 431909, "predicted": "Severe", "actual": "Severe", "confidence": 0.5096437340242616, "match": true}, {"seed": 31, "sample_idx": 419856, "predicted": "Severe", "actual": "Severe", "confidence": 0.5435439606222685, "match": true}, {"seed": 32, "sample_idx": 10967, "predicted": "Moderate", "actual": "Moderate", "confidence": 0.6496252290521405, "match": true}, {"seed": 33, "sample_idx": 104152, "predicted": "Mild", "actual": "Mild", "confidence": 0.7568473998386278, "match": true}, {"seed": 34, "sample_idx": 305642, "predicted": "Healthy", "actual": "Healthy", "confidence": 0.9775, "match": true}, {"seed": 35, "sample_idx": 202441, "predicted": "Mild", "actual": "Mild", "confidence": 0.7665929533429534, "match": true}, {"seed": 36, "sample_idx": 222110, "predicted": "Critical", "actual": "Critical", "confidence": 0.7138814278008048, "match": true}, {"seed": 37, "sample_idx": 282987, "predicted": "Healthy", "actual": "Healthy", "confidence": 0.9971428571428572, "match": true}, {"seed": 38, "sample_idx": 32161, "predicted": "Mild", "actual": "Mild", "confidence": 0.6390203282269845, "match": true}, {"seed": 39, "sample_idx": 60809, "predicted": "Mild", "actual": "Mild", "confidence": 0.6837460317460317, "match": true}, {"seed": 40, "sample_idx": 473253, "predicted": "Mild", "actual": "Mild", "confidence": 0.5766449579831934, "match": true}, {"seed": 41, "sample_idx": 250960, "predicted": "Mild", "actual": "Mild", "confidence": 0.8065540542952823, "match": true}, {"seed": 42, "sample_idx": 121958, "predicted": "Healthy", "actual": "Healthy", "confidence": 0.9957142857142857, "match": true}, {"seed": 43, "sample_idx": 276292, "predicted": "Mild", "actual": "Mild", "confidence": 0.6912240790062931, "match": true}, {"seed": 44, "sample_idx": 538388, "predicted": "Moderate", "actual": "Moderate", "confidence": 0.9144525177887246, "match": true}, {"seed": 45, "sample_idx": 399774, "predicted": "Moderate", "actual": "Moderate", "confidence": 0.6410752939870588, "match": true}, {"seed": 46, "sample_idx": 605373, "predicted": "Moderate", "actual": "Moderate", "confidence": 0.8854444444444445, "match": true}, {"seed": 47, "sample_idx": 506183, "predicted": "Healthy", "actual": "Healthy", "confidence": 0.9966666666666666, "match": true}, {"seed": 48, "sample_idx": 488900, "predicted": "Mild", "actual": "Mild", "confidence": 0.6880103442961836, "match": true}, {"seed": 49, "sample_idx": 448173, "predicted": "Moderate", "actual": "Moderate", "confidence": 0.9476944444444445, "match": true}, {"seed": 50, "sample_idx": 103904, "predicted": "Moderate", "actual": "Moderate", "confidence": 0.6582792786862381, "match": true}, {"seed": 51, "sample_idx": 147941, "predicted": "Mild", "actual": "Mild", "confidence": 0.5528163595663597, "match": true}, {"seed": 52, "sample_idx": 482293, "predicted": "Severe", "actual": "Severe", "confidence": 0.5899497797524114, "match": true}, {"seed": 53, "sample_idx": 189213, "predicted": "Severe", "actual": "Severe", "confidence": 0.5289287882167141, "match": true}, {"seed": 54, "sample_idx": 72815, "predicted": "Moderate", "actual": "Moderate", "confidence": 0.7650717391304349, "match": true}, {"seed": 55, "sample_idx": 389581, "predicted": "Moderate", "actual": "Moderate", "confidence": 0.7305902611880876, "match": true}, {"seed": 56, "sample_idx": 261973, "predicted": "Critical", "actual": "Critical", "confidence": 0.5927278473454695, "match": true}, {"seed": 57, "sample_idx": 536278, "predicted": "Asymptomatic", "actual": "Asymptomatic", "confidence": 0.9755833333333332, "match": true}, {"seed": 58, "sample_idx": 495395, "predicted": "Moderate", "actual": "Moderate", "confidence": 0.9099206349206348, "match": true}, {"seed": 59, "sample_idx": 375168, "predicted": "Healthy", "actual": "Healthy", "confidence": 0.9842857142857143, "match": true}, {"seed": 60, "sample_idx": 395469, "predicted": "Healthy", "actual": "Healthy", "confidence": 0.9933333333333334, "match": true}, {"seed": 61, "sample_idx": 28259, "predicted": "Asymptomatic", "actual": "Asymptomatic", "confidence": 0.9754761904761905, "match": true}, {"seed": 62, "sample_idx": 271890, "predicted": "Moderate", "actual": "Moderate", "confidence": 0.8139818485607959, "match": true}, {"seed": 63, "sample_idx": 32907, "predicted": "Moderate", "actual": "Mild", "confidence": 0.581002694039173, "match": false}, {"seed": 64, "sample_idx": 611302, "predicted": "Severe", "actual": "Severe", "confidence": 0.784501393011206, "match": true}, {"seed": 65, "sample_idx": 597806, "predicted": "Moderate", "actual": "Moderate", "confidence": 0.650642499263189, "match": true}, {"seed": 66, "sample_idx": 385852, "predicted": "Moderate", "actual": "Moderate", "confidence": 0.927420634920635, "match": true}, {"seed": 67, "sample_idx": 436231, "predicted": "Healthy", "actual": "Healthy", "confidence": 0.99, "match": true}, {"seed": 68, "sample_idx": 404287, "predicted": "Mild", "actual": "Mild", "confidence": 0.7635365363802863, "match": true}, {"seed": 69, "sample_idx": 457782, "predicted": "Moderate", "actual": "Moderate", "confidence": 0.6120002526209423, "match": true}, {"seed": 70, "sample_idx": 480370, "predicted": "Moderate", "actual": "Moderate", "confidence": 0.5957290242437301, "match": true}, {"seed": 71, "sample_idx": 121963, "predicted": "Asymptomatic", "actual": "Asymptomatic", "confidence": 0.8962824732507019, "match": true}, {"seed": 72, "sample_idx": 209368, "predicted": "Healthy", "actual": "Healthy", "confidence": 0.9966666666666666, "match": true}, {"seed": 73, "sample_idx": 480150, "predicted": "Moderate", "actual": "Moderate", "confidence": 0.7768971970058928, "match": true}, {"seed": 74, "sample_idx": 231326, "predicted": "Critical", "actual": "Severe", "confidence": 0.49063070524750674, "match": false}, {"seed": 75, "sample_idx": 397560, "predicted": "Healthy", "actual": "Healthy", "confidence": 0.98925, "match": true}, {"seed": 76, "sample_idx": 166561, "predicted": "Severe", "actual": "Severe", "confidence": 0.766559658937758, "match": true}, {"seed": 77, "sample_idx": 598623, "predicted": "Healthy", "actual": "Healthy", "confidence": 0.99, "match": true}, {"seed": 78, "sample_idx": 367301, "predicted": "Healthy", "actual": "Healthy", "confidence": 0.9966666666666666, "match": true}, {"seed": 79, "sample_idx": 38077, "predicted": "Critical", "actual": "Critical", "confidence": 0.8038841991341991, "match": true}, {"seed": 80, "sample_idx": 562364, "predicted": "Severe", "actual": "Severe", "confidence": 0.8268598614775086, "match": true}, {"seed": 81, "sample_idx": 390849, "predicted": "Healthy", "actual": "Healthy", "confidence": 1.0, "match": true}, {"seed": 82, "sample_idx": 340099, "predicted": "Moderate", "actual": "Moderate", "confidence": 0.725661689759516, "match": true}, {"seed": 83, "sample_idx": 290048, "predicted": "Critical", "actual": "Critical", "confidence": 0.5374004050702756, "match": true}, {"seed": 84, "sample_idx": 612266, "predicted": "Moderate", "actual": "Mild", "confidence": 0.6208106915971705, "match": false}, {"seed": 85, "sample_idx": 53610, "predicted": "Critical", "actual": "Critical", "confidence": 0.6148335645529416, "match": true}, {"seed": 86, "sample_idx": 265644, "predicted": "Moderate", "actual": "Moderate", "confidence": 0.6156323281809349, "match": true}, {"seed": 87, "sample_idx": 60902, "predicted": "Moderate", "actual": "Moderate", "confidence": 0.6104653991841491, "match": true}, {"seed": 88, "sample_idx": 387032, "predicted": "Non_covid", "actual": "Non_covid", "confidence": 0.9583333333333333, "match": true}, {"seed": 89, "sample_idx": 581918, "predicted": "Non_covid", "actual": "Non_covid", "confidence": 0.9484401709401711, "match": true}, {"seed": 90, "sample_idx": 599363, "predicted": "Moderate", "actual": "Moderate", "confidence": 0.8635733384262795, "match": true}, {"seed": 91, "sample_idx": 325810, "predicted": "Critical", "actual": "Critical", "confidence": 0.8452803030303031, "match": true}, {"seed": 92, "sample_idx": 594042, "predicted": "Severe", "actual": "Severe", "confidence": 0.7702596441377433, "match": true}, {"seed": 93, "sample_idx": 175492, "predicted": "Healthy", "actual": "Healthy", "confidence": 0.9926282051282052, "match": true}, {"seed": 94, "sample_idx": 633531, "predicted": "Critical", "actual": "Critical", "confidence": 0.5319718987939432, "match": true}, {"seed": 95, "sample_idx": 187798, "predicted": "Critical", "actual": "Critical", "confidence": 0.6069312999724292, "match": true}, {"seed": 96, "sample_idx": 374868, "predicted": "Moderate", "actual": "Moderate", "confidence": 0.584083751870231, "match": true}, {"seed": 97, "sample_idx": 129114, "predicted": "Moderate", "actual": "Moderate", "confidence": 0.8039091017677975, "match": true}, {"seed": 98, "sample_idx": 384474, "predicted": "Asymptomatic", "actual": "Critical", "confidence": 0.6810595238095237, "match": false}, {"seed": 99, "sample_idx": 547875, "predicted": "Severe", "actual": "Severe", "confidence": 0.708691455430586, "match": true}, {"seed": 100, "sample_idx": 56088, "predicted": "Moderate", "actual": "Moderate", "confidence": 0.8967150318979268, "match": true}];
  const COLORS = {"Healthy": "#00CC96", "Asymptomatic": "#AB63FA", "Mild": "#FFA15A", "Moderate": "#19D3F3", "Severe": "#FF6692", "Critical": "#EF553B", "Non-covid": "#636EFA"};

  // Helper: find record by seed
  function getRecord(seed) {
    return DATA.find(d => d.seed === seed);
  }

  // Build initial figure (seed 50)
  const initialSeed = 50;
  let currentSeed = initialSeed;
  let predictionShown = false;

  const rec = getRecord(initialSeed);
  const actualColor = COLORS[rec.actual] || '#FFFFFF';
  const predictedColor = COLORS[rec.predicted] || '#FFFFFF';
  const matchText = rec.match ? '\u2713 Correct!' : '\u2717 Incorrect';
  const matchColor = rec.match ? '#00FF00' : '#FF0000';

  const layout = {
    paper_bgcolor: '#2A2A2A',
    plot_bgcolor: '#2A2A2A',
    width: 1000,
    height: 560,
    margin: { l: 40, r: 40, t: 40, b: 20 },
    xaxis: { range: [0, 1], showgrid: false, showticklabels: false, zeroline: false },
    yaxis: { range: [0, 1], showgrid: false, showticklabels: false, zeroline: false },
    hovermode: false,
    showlegend: false,
    annotations: [
      // Titles over circles - moved higher and further from center
      {
        x: 0.1, y: 0.95, xref: 'paper', yref: 'paper', showarrow: false,
        text: '<b>Selected Cell</b>', font: { size: 14, color: 'white' }
      },
      {
        x: 0.92, y: 0.95, xref: 'paper', yref: 'paper', showarrow: false,
        text: '<b>Model Prediction</b>', font: { size: 14, color: 'white' }
      }
    ]
  };

  // Traces: left (selected) + right (prediction) panel
  const traces = [
    // Left circle
    {
      x: [0.15], y: [0.75], mode: 'markers',
      marker: { size: 100, color: actualColor, line: { width: 2, color: 'white' } },
      hoverinfo: 'skip'
    },
    // Left text: actual
    {
      x: [0.15], y: [0.55], mode: 'text',
      text: [`<b>${rec.actual}</b>`], textfont: { size: 14, color: 'white' },
      hoverinfo: 'skip'
    },
    // Left text: cell #
    {
      x: [0.15], y: [0.5], mode: 'text',
      text: [`<b>Cell #${rec.sample_idx}</b>`], textfont: { size: 12, color: 'white' },
      hoverinfo: 'skip'
    },

    // Right circle (hidden until Predict!)
    {
      x: [0.85], y: [0.75], mode: 'markers',
      marker: { size: 100, color: predictedColor, line: { width: 2, color: 'white' } },
      hoverinfo: 'skip', visible: false
    },
    // Right text: predicted
    {
      x: [0.85], y: [0.55], mode: 'text',
      text: [`<b>${rec.predicted}</b>`], textfont: { size: 14, color: 'white' },
      hoverinfo: 'skip', visible: false
    },
    // Right text: correct/incorrect
    {
      x: [0.85], y: [0.5], mode: 'text',
      text: [`<b>${matchText}</b>`], textfont: { size: 12, color: matchColor },
      hoverinfo: 'skip', visible: false
    },
    // Right text: confidence
    {
      x: [0.85], y: [0.45], mode: 'text',
      text: [`<b>Confidence: ${(rec.confidence * 100).toFixed(1)}%</b>`], textfont: { size: 11, color: 'white' },
      hoverinfo: 'skip', visible: false
    },
  ];

  Plotly.newPlot('plot', traces, layout, {displayModeBar: false});

  // Slider handling
  const slider = document.getElementById('seedSlider');
  const seedLabel = document.getElementById('seedValue');
  const predictBtn = document.getElementById('predictBtn');

  slider.addEventListener('input', (e) => {
    const seed = Number(e.target.value);
    currentSeed = seed;
    seedLabel.textContent = `Seed: ${seed}`;

    const r = getRecord(seed);
    const ac = COLORS[r.actual] || '#FFFFFF';
    const pc = COLORS[r.predicted] || '#FFFFFF';
    const mtext = r.match ? '\u2713 Correct!' : '\u2717 Incorrect';
    const mcolor = r.match ? '#00FF00' : '#FF0000';

    // Update left side traces (0..2)
    Plotly.restyle('plot', {
      x: [[0.15], [0.15], [0.15]],
      y: [[0.75], [0.55], [0.50]],
      marker: [{ size: 100, color: ac, line: { width: 2, color: 'white' } }],
      text: [null, [`<b>${r.actual}</b>`], [`<b>Cell #${r.sample_idx}</b>`]],
    }, [0,1,2]);

    // Hide right side until Predict! is clicked
    predictionShown = false;
    Plotly.restyle('plot', {
      visible: [false, false, false, false],
    }, [3,4,5,6]);

    // Update right-side content while hidden
    Plotly.restyle('plot', {
      x: [[0.85], [0.85], [0.85], [0.85]],
      y: [[0.75], [0.55], [0.50], [0.45]],
      marker: [{ size: 100, color: pc, line: { width: 2, color: 'white' } }],
      text: [null, [`<b>${r.predicted}</b>`], [`<b>${mtext}</b>`], [`<b>Confidence: ${(r.confidence * 100).toFixed(1)}%</b>`]],
      textfont: [null, {size: 14, color: 'white'}, {size: 12, color: mcolor}, {size: 11, color: 'white'}]
    }, [3,4,5,6]);
  });

  // Predict button: show/hide right panel
  predictBtn.addEventListener('click', () => {
    predictionShown = !predictionShown;
    Plotly.restyle('plot', {
      visible: [predictionShown, predictionShown, predictionShown, predictionShown],
    }, [3,4,5,6]);
  });
</script>
</body>
</html>
